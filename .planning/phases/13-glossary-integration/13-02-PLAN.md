---
phase: 13-glossary-integration
plan: 02
type: execute
wave: 2
depends_on: ["13-01"]
files_modified:
  - skills/control-erp-glossary/control-erp-glossary-SKILL.md
autonomous: true

must_haves:
  truths:
    - "Glossary NL routing table includes entries for ALL 6 domain skills (core, sales, financial, customers, inventory, production)"
    - "Glossary routes customer-centric queries to control-erp-customers (not sales)"
    - "Glossary routes inventory queries to control-erp-inventory"
    - "Glossary routes production/artwork queries to control-erp-production"
    - "Glossary routes report-discovery queries to Crystal Reports Catalog (self)"
    - "25 test queries achieve 90%+ routing accuracy against the routing table"
    - "Routing table includes overlap resolution (ambiguous queries prompt clarification)"
  artifacts:
    - path: "skills/control-erp-glossary/control-erp-glossary-SKILL.md"
      provides: "Expanded NL routing table with 75+ entries covering all 6 domain skills"
      contains: "control-erp-customers"
    - path: "skills/control-erp-glossary/control-erp-glossary-SKILL.md"
      provides: "NL routing for inventory, production, and report discovery"
      contains: "control-erp-inventory"
  key_links:
    - from: "NL routing table"
      to: "control-erp-customers"
      via: "customer-centric query patterns"
      pattern: "control-erp-customers"
    - from: "NL routing table"
      to: "control-erp-inventory"
      via: "stock and parts query patterns"
      pattern: "control-erp-inventory"
    - from: "NL routing table"
      to: "control-erp-production"
      via: "artwork and station query patterns"
      pattern: "control-erp-production"
---

<objective>
Expand the glossary NL routing table to cover all 6 domain skills and validate routing accuracy with 25 test queries.

Purpose: Every business question from any FLS team member gets routed to the correct skill with 90%+ accuracy. Three domain skills (customers, inventory, production) currently have ZERO routing entries -- this plan fills the gap. Report discovery queries are also added.
Output: Updated glossary with 75+ routing entries; validated against 25 test queries
</objective>

<execution_context>
@/Users/cain/.claude/get-shit-done/workflows/execute-plan.md
@/Users/cain/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/13-glossary-integration/13-CONTEXT.md
@.planning/phases/13-glossary-integration/13-RESEARCH.md
@.planning/phases/13-glossary-integration/13-01-SUMMARY.md
@skills/control-erp-glossary/control-erp-glossary-SKILL.md
@skills/control-erp-customers/control-erp-customers-SKILL.md
@skills/control-erp-inventory/control-erp-inventory-SKILL.md
@skills/control-erp-production/control-erp-production-SKILL.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Expand NL routing table to cover all 6 domain skills</name>
  <files>skills/control-erp-glossary/control-erp-glossary-SKILL.md</files>
  <action>
Rewrite the "## NATURAL LANGUAGE ROUTING TABLE" section to include entries for ALL 6 domain skills plus report discovery and gap routing. The existing 37 entries cover sales, financial, core, and glossary. This task adds entries for customers, inventory, production, and report discovery -- and fixes the "top customers" routing (currently routes to sales, should route to customers per research).

**Updated routing table structure:**

Organize entries by destination skill with sub-headers for clarity. Keep the same table format:
```
| User Says | Route To | Key Pattern/Section |
|-----------|----------|-------------------|
```

**Entries to ADD (organized by skill):**

### control-erp-customers (NEW -- currently 0 entries)
| "top customers" / "biggest customers" / "best customers" | control-erp-customers | Customer Ranking (Top N) |
| "customer profile for [X]" / "look up [customer]" / "who is [customer]" | control-erp-customers | Customer Search + Profile |
| "customer segmentation" / "RFM" / "customer tiers" | control-erp-customers | RFM Segmentation |
| "at-risk customers" / "churn risk" / "customers we might lose" | control-erp-customers | At-Risk Detection |
| "dormant customers" / "haven't ordered in [X] months" | control-erp-customers | Dormancy Detection |
| "customer order history" / "what has [customer] ordered" | control-erp-customers | Order History drill-down |
| "new customers" / "customer acquisition" | control-erp-customers | New Customer Identification |
| "customer AR" / "what does [customer] owe" / "[customer] balance" | control-erp-customers | Customer AR Balance |
| "customer lifetime value" / "CLV" | control-erp-customers | RFM + Revenue Ranking |
| "repeat customers" / "customer retention" | control-erp-customers | Order Frequency Analysis |

### control-erp-inventory (NEW -- currently 0 entries)
| "check stock for [X]" / "what's in stock" / "inventory for [part]" | control-erp-inventory | Stock Level Check |
| "what needs reordering" / "low stock" / "below reorder point" | control-erp-inventory | Reorder Alert |
| "what does [X] cost" / "last price paid for [part]" | control-erp-inventory | Last Price Paid (PO history) |
| "top vendors" / "who do we buy from" | control-erp-inventory | Top Vendors by PO |
| "how much [part] do we use" / "consumption rate" / "usage rate" | control-erp-inventory | Material Consumption |
| "PO history" / "purchase orders for [part]" | control-erp-inventory | PO History for Part |
| "parts list" / "all parts" / "part categories" | control-erp-inventory | Part Search and Browse |
| "months of supply" / "how long will stock last" | control-erp-inventory | Months of Supply (secondary tier) |

### control-erp-production (NEW -- currently 0 entries)
| "artwork pipeline" / "pending approvals" / "artwork status" | control-erp-production | Artwork Pipeline Summary |
| "what's in production" / "WIP" / "work in progress" | control-erp-production | Order-Level WIP by Station |
| "which stations are backed up" / "bottlenecks" | control-erp-production | Bottleneck Detection |
| "dwell time" / "how long at [station]" / "station time" | control-erp-production | Average Dwell Time |
| "station workload" / "what's at [station]" | control-erp-production | Station Workload |
| "stuck artwork" / "overdue proofs" | control-erp-production | Stuck Detection (7-day threshold) |
| "artwork turnaround" / "how long does approval take" | control-erp-production | Turnaround Analysis |
| "revision rate" / "how many revisions" | control-erp-production | Revision Rate per Group |

### Report Discovery (NEW -- currently 0 entries)
| "is there a report for [X]" / "what report shows [X]" | control-erp-glossary | Crystal Reports Catalog (above) |
| "AR report" / "aging report" | control-erp-glossary | Crystal Reports Catalog → then route to skill |
| "sales report" / "revenue report" | control-erp-glossary | Crystal Reports Catalog → then route to skill |
| "inventory report" / "parts report" | control-erp-glossary | Crystal Reports Catalog → then route to skill |
| "WIP report" / "production report" | control-erp-glossary | Crystal Reports Catalog → then route to skill |

### Gap / Not Covered
| "timecards" / "payroll" / "overtime" | NOT COVERED | See gap-log.md |
| "commissions" / "commission rates" | NOT COVERED | See gap-log.md |
| "shipping tracking" / "tracking numbers" | NOT COVERED | See gap-log.md |
| "product parameters" / "product configuration" | NOT COVERED | See gap-log.md |

**Entries to MODIFY (existing routes that need updating):**

1. **CHANGE** `"top customers" / "customer revenue"` from `control-erp-sales Template 6` to split:
   - `"top customers" / "biggest customers"` → `control-erp-customers` (comprehensive ranking with Pareto, YoY, segmentation)
   - `"customer revenue" / "[customer] sales"` → keep at `control-erp-sales Template 6` (revenue context)

**Entries to KEEP (existing routes that stay unchanged):**
All existing sales, financial, core, and glossary routes stay as-is EXCEPT the "top customers" entry above.

**Add a synchronization note at the top of the routing table:**
```
> Last synchronized with domain skills: [execution date]. Update this table when any domain skill's NL patterns change.
```

**Add overlap resolution section after the routing table:**
```
### Overlap Resolution

When a query could match multiple skills, apply these rules:
- "top customers" → control-erp-customers (comprehensive ranking); control-erp-sales also has a simpler version
- "revenue by product" → control-erp-sales (TransHeader-based); control-erp-financial if user asks for GL perspective
- "WIP" → control-erp-production (station detail) unless user asks for WIP balance/value → control-erp-financial
- "inventory value" → control-erp-financial (GL authoritative); control-erp-inventory for part-level detail
- When genuinely ambiguous → ask the user to clarify rather than guessing
```

**CRITICAL:** Per CONTEXT.md: "Never guess. If a query falls outside covered domains, say it's not covered."
  </action>
  <verify>
  - Grep for "control-erp-customers" in routing table -- must have 8+ entries
  - Grep for "control-erp-inventory" in routing table -- must have 6+ entries
  - Grep for "control-erp-production" in routing table -- must have 6+ entries
  - Grep for "NOT COVERED" in routing table -- must have 3+ entries
  - Grep for "Crystal Reports Catalog" in routing table -- must have 3+ entries
  - Grep for "Overlap Resolution" -- must exist
  - Verify total routing entries >= 75
  - Total glossary file line count between 680-780 lines
  </verify>
  <done>NL routing table covers all 6 domain skills with 75+ entries. "Top customers" correctly routes to control-erp-customers. Overlap resolution rules documented. Gap queries route to "NOT COVERED" with gap-log reference.</done>
</task>

<task type="auto">
  <name>Task 2: Validate routing accuracy with 25 test queries</name>
  <files>skills/control-erp-glossary/control-erp-glossary-SKILL.md</files>
  <action>
Validate the expanded routing table against 25 test queries from the research file. For each query, check that the routing table would direct it to the correct skill.

**Test queries (from 13-RESEARCH.md):**

| # | Query | Expected Route |
|---|-------|---------------|
| 1 | "whats our revenue this year" | control-erp-sales |
| 2 | "show me feather flag sales" | control-erp-sales |
| 3 | "whos our biggest customer" | control-erp-customers |
| 4 | "AR aging" | control-erp-financial |
| 5 | "what do we owe vendors" | control-erp-financial |
| 6 | "whats in stock for FR 66 knit" | control-erp-inventory |
| 7 | "what needs reordering" | control-erp-inventory |
| 8 | "pending artwork approvals" | control-erp-production |
| 9 | "is there a report for sales by product" | control-erp-glossary |
| 10 | "whats a ClassTypeID" | control-erp-glossary |
| 11 | "P&L this quarter" | control-erp-financial |
| 12 | "top 10 customers by revenue" | control-erp-customers |
| 13 | "how long does artwork approval take" | control-erp-production |
| 14 | "customer profile for FLASH" | control-erp-customers |
| 15 | "gross margin" | control-erp-financial |
| 16 | "swing flag orders this month" | control-erp-sales |
| 17 | "which stations are backed up" | control-erp-production |
| 18 | "last price paid for polyester fabric" | control-erp-inventory |
| 19 | "sales by rep" | control-erp-sales |
| 20 | "what report shows inventory levels" | control-erp-glossary |
| 21 | "dormant customers" | control-erp-customers |
| 22 | "cash position" | control-erp-financial |
| 23 | "how much do we use of FR 66 knit per month" | control-erp-inventory |
| 24 | "compare this year to last year" | control-erp-sales |
| 25 | "commission rates for sales team" | NOT COVERED |

**Process:**
1. For each test query, find the matching routing entry (exact match or closest pattern match)
2. Verify the route matches the expected destination
3. If any query would be misrouted (routes to wrong skill), fix the routing table entry
4. Count correct routes: must be >= 23/25 (92%) for 90%+ accuracy threshold

**If routing issues found:** Fix the routing table entries directly. Common fixes:
- Missing pattern variant (add alias)
- Wrong destination (change Route To column)
- No matching entry (add new row)

**After validation, add the test results as a comment at the bottom of the glossary footer:**

Update the footer text (last line of file) to include:
```
*Routing validated: [date] — 25 test queries, [N]/25 correct ([%]% accuracy)*
```

Do NOT add a full test results table to the glossary file -- it would bloat the skill. Just the one-line validation note in the footer.
  </action>
  <verify>
  - Read the routing table and manually trace each of the 25 test queries to verify correct routing
  - Accuracy must be >= 23/25 (92%)
  - Footer includes validation note with date and accuracy score
  - Total glossary file stays under 800 lines
  </verify>
  <done>25 test queries validated against routing table with 90%+ accuracy. Any misroutes fixed. Footer includes validation timestamp and accuracy score.</done>
</task>

</tasks>

<verification>
1. Routing table contains entries for all 6 skills: core, sales, financial, customers, inventory, production
2. "control-erp-customers" appears in 8+ routing entries
3. "control-erp-inventory" appears in 6+ routing entries
4. "control-erp-production" appears in 6+ routing entries
5. Report discovery queries route to Crystal Reports Catalog
6. Gap queries route to "NOT COVERED" with gap-log.md reference
7. "top customers" routes to control-erp-customers (not sales)
8. Overlap resolution section exists with 5+ rules
9. 25 test queries achieve >= 92% accuracy (23/25 correct)
10. Final glossary file is under 800 lines total
11. Footer includes routing validation note with date and accuracy percentage
</verification>

<success_criteria>
- All 6 domain skills have routing entries in the glossary
- 25 test queries achieve 90%+ routing accuracy
- Overlap resolution documented for ambiguous queries
- "top customers" correctly routes to control-erp-customers
- Gap queries are honestly labeled as NOT COVERED
- Glossary stays lean (under 800 lines)
</success_criteria>

<output>
After completion, create `.planning/phases/13-glossary-integration/13-02-SUMMARY.md`
</output>
