---
phase: 05-financial-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - skills/control-erp-financial/control-erp-financial-SKILL.md
autonomous: true

must_haves:
  truths:
    - "All system account NodeIDs use their exact GLAccount.AccountName from the database (91=Undeposited Cash, 90=Cash-Associated Bank-Checking)"
    - "Missing system accounts (15, 25, 34, 52, 60, 61, 93, 543, 10528, 10530, 10531) are documented with purpose and GLClassificationType"
    - "Ledger field reference covers EntryType, Classification, OffBalanceSheet, DepositJournalID, and Reconciled with value mappings"
    - "Closeout table reference documents CloseoutType values (1=Daily, 2=Monthly, 3=Yearly, 5=Export, 6=CC Settlement)"
  artifacts:
    - path: "skills/control-erp-financial/control-erp-financial-SKILL.md"
      provides: "Corrected NodeID names, complete system accounts, Ledger field reference, Closeout reference"
      contains: "Undeposited Cash"
  key_links:
    - from: "Critical System Account NodeIDs table"
      to: "GLAccount table in live database"
      via: "SELECT ID, AccountName FROM GLAccount WHERE ID IN (...)"
      pattern: "Undeposited Cash"
---

<objective>
Verify and correct the existing financial skill's GL account documentation and add missing reference sections for Ledger fields and Closeout.

Purpose: The financial skill has two categories of gaps: (1) inaccurate NodeID names that could confuse users, and (2) missing reference material for Ledger fields and Closeout that advanced financial queries need. This plan fixes inaccuracies and adds the missing reference sections.

Output: Updated `skills/control-erp-financial/control-erp-financial-SKILL.md` with corrected names, complete system accounts, Ledger field reference, and Closeout reference.
</objective>

<execution_context>
@/Users/cain/.claude/get-shit-done/workflows/execute-plan.md
@/Users/cain/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-financial-foundation/05-RESEARCH.md
@skills/control-erp-financial/control-erp-financial-SKILL.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix NodeID names and add missing system accounts</name>
  <files>skills/control-erp-financial/control-erp-financial-SKILL.md</files>
  <action>
  This task has two parts, both editing the "Critical System Account NodeIDs" section and its surrounding tables.

  **Part A: Fix name inaccuracies in the existing table.**
  Query the database to confirm exact names:
  ```sql
  SELECT ID, AccountName, GLClassificationType FROM GLAccount WHERE ID IN (11, 12, 14, 21, 22, 23, 24, 90, 91, 92, 93, 10137, 10412, 10414)
  ```
  Then update the "Critical System Account NodeIDs" table:
  - NodeID 90: Change "Cash-Checking" to the exact AccountName from the DB query (research says "Cash-Associated Bank-Checking")
  - NodeID 91: It's currently not in the table but referenced as "Undeposited Funds" in the Stage 2 GL entry example. Fix the Stage 2 example to use the correct name "Undeposited Cash"

  **Part B: Add a new "Supporting System Accounts" subsection AFTER the Critical System Account NodeIDs table.**

  Query the database:
  ```sql
  SELECT ID, AccountName, GLClassificationType FROM GLAccount WHERE ID IN (15, 25, 34, 52, 60, 61, 93, 543, 10528, 10530, 10531)
  ```

  Create a new subsection titled "### Supporting System Accounts" with a table containing these accounts, their exact AccountName from DB, their GLClassificationType, and a brief purpose note based on the research:
  - 15 = Direct Costs from Bills (intermediary for bill costs assigned to orders)
  - 25 = Vendor Credit (vendor credit balances)
  - 34 = Cost Of Built - FGI (holds costs during Built status before sale)
  - 52 = Credit Given (customer credit adjustments expense)
  - 60 = Unclassified Inventory (off-balance sheet cost tracking for expensed parts)
  - 61 = Unclassified Expense (off-balance sheet expense tracking)
  - 93 = Undeposited Checks (check deposits pending)
  - 543 = Undeposited Discover (Discover CC deposits pending)
  - 10528 = Undeposited Authorize.net (online CC deposits pending)
  - 10530 = Undeposited PayPal (PayPal deposits pending)
  - 10531 = Undeposited Shopify (Shopify deposits pending)

  Also add a "### Complete Undeposited Fund Accounts" subsection listing ALL active undeposited accounts (GLClassificationType=1007). Query:
  ```sql
  SELECT ID, AccountName, IsActive FROM GLAccount WHERE GLClassificationType = 1007 ORDER BY ID
  ```
  Present as a table with NodeID, AccountName, and Status (Active/Legacy). Mark ZoomTex accounts (10522-10525) as Legacy.

  **What NOT to change:** Do not modify the Revenue Account NodeIDs, COGS Account NodeIDs, or any query sections. Only touch the system account tables and the Stage 2 GL entry example.
  </action>
  <verify>
  Read the modified file and confirm:
  1. NodeID 90 shows the exact AccountName from the database
  2. The Stage 2 GL entry example no longer says "Cash (91)" but uses "Undeposited Cash (91)"
  3. A "Supporting System Accounts" subsection exists with 11 accounts
  4. A "Complete Undeposited Fund Accounts" subsection exists with all GLClassificationType=1007 accounts
  </verify>
  <done>
  All system account NodeIDs in the financial skill use exact GLAccount.AccountName values from the database. Missing system accounts (15, 25, 34, 52, 60, 61, 93, 543, 10528, 10530, 10531) are documented with purpose. All undeposited fund accounts are listed with Active/Legacy status.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add Ledger field reference and Closeout section</name>
  <files>skills/control-erp-financial/control-erp-financial-SKILL.md</files>
  <action>
  Add two new reference sections to the financial skill.

  **Part A: Add "### Complete Ledger Field Reference" subsection** inside the GL/LEDGER ARCHITECTURE section, AFTER the "Key GL/Ledger Fields" subsection.

  Query to confirm fields exist:
  ```sql
  SELECT COLUMN_NAME, DATA_TYPE, IS_NULLABLE FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'Ledger' ORDER BY ORDINAL_POSITION
  ```

  Create a table documenting these important Ledger fields (beyond the 5 already documented):

  | Field | Type | Purpose |
  |-------|------|---------|
  | EntryType | int | Entry category: NULL/0=unset, 1=Manual/Adjustments, 2=Order lifecycle (dominant), 3=Payment-related, 4=Credit adjustments, 5=Bill lifecycle |
  | Classification | int | Fine-grained event classification (49 values). 0=general, 100=sale events. Rarely needed for user queries |
  | OffBalanceSheet | bit | 0=on-balance sheet (in GL view), 1=off-balance sheet (filtered from GL view) |
  | DepositJournalID | int | Links payment GL entries to their deposit batch Journal |
  | Reconciled | bit | Whether entry has been bank-reconciled |
  | ReconciliationDateTime | datetime | When the entry was reconciled |
  | DivisionID | int | Division the entry belongs to (FK to Division) |
  | StationID | int | Production station for cost entries (FK to Station) |
  | PartID | int | Part/material for inventory entries (FK to Part) |
  | PayrollID | int | Payroll entry link (FK to Payroll) |
  | WarehouseID | int | Warehouse for inventory entries (FK to Warehouse) |
  | ClassTypeID | int | Almost always 8900 for all Ledger entries |

  Add a note: "The Ledger table has 53 columns total. The fields above are the most query-relevant beyond the 5 key fields already documented. For full schema, see `output/schemas/Ledger.md`."

  Add a brief "#### EntryType Reference" sub-subsection with a small table:

  | Value | Meaning | Typical Count |
  |-------|---------|--------------|
  | NULL | Unset/legacy | varies |
  | 1 | Manual journal entries (bank fees, loan payments) | ~2K |
  | 2 | Order lifecycle entries | ~2.3M (dominant) |
  | 3 | Payment-related entries | ~397K |
  | 4 | Credit adjustments | ~30 |
  | 5 | Bill lifecycle entries | ~743 |

  Mark confidence as MEDIUM -- "Values inferred from Description pattern correlation, not official documentation."

  **Part B: Add "## CLOSEOUT â€” PERIOD LOCKING" section** BEFORE the "## IMPORTANT CAVEATS" section at the bottom of the file.

  Query to confirm:
  ```sql
  SELECT TOP 5 ID, CloseoutType, ClassTypeID, StartDate, EndDate, ClosedDate, IsActive FROM Closeout ORDER BY ClosedDate DESC
  ```

  Document:
  - Closeout table purpose: locks GL periods to prevent backdated entries
  - ClassTypeID = 8911 for all Closeout records
  - CloseoutType reference table:

  | CloseoutType | Name | Purpose |
  |-------------|------|---------|
  | 1 | Daily | Daily business close |
  | 2 | Monthly | Monthly accounting close |
  | 3 | Yearly | Yearly fiscal close |
  | 5 | Export | GL export for external accounting |
  | 6 | Credit Card Settlement | CC batch settlement |

  - Key fields: StartDate, EndDate, ClosedDate, ClosedByID
  - Usage note: "The most recent Closeout of each type determines the locked period boundary. GL entries before the last closeout date cannot be modified without reopening the period."
  - Query example:
  ```sql
  -- Last closeout dates by type
  SELECT CloseoutType,
      CASE CloseoutType WHEN 1 THEN 'Daily' WHEN 2 THEN 'Monthly' WHEN 3 THEN 'Yearly' WHEN 5 THEN 'Export' WHEN 6 THEN 'CC Settlement' END AS Name,
      MAX(EndDate) AS LastClosedThrough
  FROM Closeout
  WHERE IsActive = 1
  GROUP BY CloseoutType
  ```

  **What NOT to change:** Do not modify any existing query sections, AR/AP sections, P&L sections, or the Natural Language Interpretation table.
  </action>
  <verify>
  Read the modified file and confirm:
  1. A "Complete Ledger Field Reference" subsection exists with EntryType, Classification, OffBalanceSheet, DepositJournalID, Reconciled, and other fields
  2. An "EntryType Reference" sub-subsection exists with the 5 value mappings
  3. A "CLOSEOUT -- PERIOD LOCKING" section exists before IMPORTANT CAVEATS
  4. The Closeout section has CloseoutType reference table and a query example
  5. No existing validated sections (AR, AP, P&L, Revenue tables) were modified
  </verify>
  <done>
  Ledger field reference documents all query-relevant fields beyond the 5 key fields, with EntryType value mappings. Closeout table reference documents CloseoutType values and period locking mechanics with a query example.
  </done>
</task>

</tasks>

<verification>
After both tasks complete:
1. Run a word search for "Undeposited Funds" in the file -- should NOT appear (replaced with "Undeposited Cash")
2. Run a word search for "Cash-Checking" without "Associated Bank" -- should only appear in queries/comments, not in account name tables
3. Confirm the file has these new sections: "Supporting System Accounts", "Complete Undeposited Fund Accounts", "Complete Ledger Field Reference", "EntryType Reference", "CLOSEOUT"
4. Confirm no changes were made to AR Snapshot, AP Snapshot, P&L, or Revenue/COGS NodeID tables
</verification>

<success_criteria>
1. All system account NodeIDs in the skill use exact database AccountName values
2. 11 missing system accounts are documented with purpose and classification
3. All undeposited fund accounts listed with Active/Legacy status
4. Ledger field reference covers EntryType (with value map), Classification, OffBalanceSheet, DepositJournalID, Reconciled
5. Closeout section documents CloseoutType values and period locking with query example
</success_criteria>

<output>
After completion, create `.planning/phases/05-financial-foundation/05-01-SUMMARY.md`
</output>
