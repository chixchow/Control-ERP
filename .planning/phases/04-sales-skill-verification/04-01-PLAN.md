---
phase: 04-sales-skill-verification
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - skills/control-erp-sales/control-erp-sales-SKILL.md
  - .planning/phases/04-sales-skill-verification/04-VERIFICATION.md
autonomous: true

must_haves:
  truths:
    - "SALES-01: DyeSub Print container architecture is fully documented with VariableIDs, categories, ValueAsStr25, no-filter warning, and working query"
    - "SALES-02: Table Cover identification via Description patterns and GoodsItemID=10026 is documented with TC_ variable limitation explained"
    - "SALES-03: All non-container products (Garments, Design, Shipping, Tents, Banners hw, SEG hw, Flags hw, Other) are documented with LIKE patterns and revenue"
    - "No overlap exists between product identification patterns (DyeSub container vs Description-based groups)"
    - "The DyeLux/Garment discrepancy vs Control report is explicitly explained in the skill"
  artifacts:
    - path: "skills/control-erp-sales/control-erp-sales-SKILL.md"
      provides: "Complete product architecture and identification patterns for SALES-01, -02, -03"
      contains: "VariableID.*11053"
    - path: ".planning/phases/04-sales-skill-verification/04-VERIFICATION.md"
      provides: "Formal verification report for SALES-01 through SALES-03"
      contains: "SALES-01.*PASS"
  key_links:
    - from: "skills/control-erp-sales/control-erp-sales-SKILL.md"
      to: "skills/control-erp-core/control-erp-core-SKILL.md"
      via: "Depends on core for TransactionType, StatusID, revenue formula"
      pattern: "Depends on.*control-erp-core"
---

<objective>
Audit the control-erp-sales skill documentation for completeness against SALES-01, SALES-02, and SALES-03 requirements. Verify every product identification pattern is documented, check for pattern overlaps that could cause double-counting, investigate the "Other Products/Services" bucket ($256K) for miscategorized products, and document the DyeLux/Garment discrepancy vs Control reports.

Purpose: The skill was built and tested in a single session (21/21 PASS). This plan performs independent verification of the DOCUMENTATION side -- does the skill file contain everything a future Claude instance needs to correctly answer product-related sales questions without any prior context?

Output: Updated skill file (if gaps found) + formal verification report sections for SALES-01, -02, -03.
</objective>

<execution_context>
@/Users/cain/.claude/get-shit-done/workflows/execute-plan.md
@/Users/cain/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-sales-skill-verification/04-RESEARCH.md
@skills/control-erp-sales/control-erp-sales-SKILL.md
@skills/control-erp-core/control-erp-core-SKILL.md
@output/phase2-test-results.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Audit skill documentation against SALES-01, SALES-02, SALES-03 checklists</name>
  <files>skills/control-erp-sales/control-erp-sales-SKILL.md, .planning/phases/04-sales-skill-verification/04-VERIFICATION.md</files>
  <action>
Read `skills/control-erp-sales/control-erp-sales-SKILL.md` in full. For each of the three SALES requirements, systematically check every item on the checklist below.

**SALES-01 checklist (DyeSub Print Container Architecture):**
1. DyeSub Print identified as a container product (not a real product) -- check for explicit "NOT a product" statement
2. FP_ProductDescription VariableID = 11053 documented
3. FP_ProductID VariableID = 11052 documented
4. Column = ValueAsStr25 documented for both
5. All 21 known categories listed with 2025 revenue figures
6. WARNING present: do NOT add IsActive or ParentClassTypeID filters to TransDetailParam
7. Working query example provided (Template 3)
8. Two-level detail documented (category vs SKU)
9. Ambiguity resolution guidance (default to category, mention SKU available)

**SALES-02 checklist (Table Cover Identification):**
1. Description pattern matching documented: `LIKE '%Dyelux%Table Cover%'` and `LIKE '%FULL%Table Cover%'`
2. GoodsItemID=10026 alternative documented
3. TC_ variables (TC_FabricCategory, TC_ProductName) explicitly flagged as NOT saved to TransDetailParam
4. DyeLux Full Print vs Other Table Covers distinction documented with revenue

**SALES-03 checklist (Non-Container Products):**
1. All non-container product groups listed: Garments/Apparel, Design/Artwork, Shipping, Tents/Pop-Ups, Other Table Covers, Banners hw, SEG hw, Flags hw, Other Products/Services
2. Each has a Description LIKE pattern
3. Each has 2025 revenue figure
4. The "Other Products/Services" catch-all is documented ($256K, 8.4%)

**Additional checks:**
5. Verify no LIKE patterns overlap with DyeSub Print container (e.g., does `%Banner%` in non-container catch DyeSub Banner items? It should not, because DyeSub items are caught first by the LEFT JOIN to TransDetailParam in Template 8's CASE statement)
6. Check whether the reconciliation CASE statement order in Template 8 prevents double-counting (DyeSub Print is the FIRST case, so any item with FP_ variables is classified as DyeSub regardless of Description)
7. Check if DyeLux/Garment discrepancy vs Control report is documented in the skill (currently in test results but may not be in the skill itself)

For each checklist item, mark PRESENT or MISSING. For any MISSING item, draft the specific text that should be added to the skill file.

If there are gaps, apply the fixes to `skills/control-erp-sales/control-erp-sales-SKILL.md`.

Begin writing `04-VERIFICATION.md` with sections for SALES-01, SALES-02, and SALES-03. For each requirement, document:
- Requirement text
- What was checked (the checklist items)
- Result (PRESENT/MISSING for each item)
- Gaps found (if any)
- Fixes applied (if any)
- Status: PASS or FAIL

**Important:** This task is documentation audit only. Do NOT run database queries. If MCP is available, ignore it for this task -- save query validation for Plan 2.
  </action>
  <verify>
Read the updated skill file and grep for each key element:
- `VariableID.*11053` and `VariableID.*11052` (SALES-01)
- `GoodsItemID.*10026` (SALES-02)
- `TC_.*not.*saved` or `TC_.*don't persist` (SALES-02)
- `IsActive.*NOT` or `Do NOT add IsActive` warning (SALES-01)
- `Other Products/Services` with revenue figure (SALES-03)
- Check that 04-VERIFICATION.md exists with SALES-01, SALES-02, SALES-03 sections each having a status line
  </verify>
  <done>All three SALES requirements (01, 02, 03) have PASS/FAIL status in 04-VERIFICATION.md. Any gaps found have been fixed in the skill file. Every checklist item is accounted for.</done>
</task>

<task type="auto">
  <name>Task 2: Investigate pattern overlaps and "Other" bucket composition</name>
  <files>skills/control-erp-sales/control-erp-sales-SKILL.md, .planning/phases/04-sales-skill-verification/04-VERIFICATION.md</files>
  <action>
Perform three deeper verification checks that go beyond surface-level documentation audit:

**Check 1: Pattern Overlap Analysis**

Read Template 8 (Full Revenue Reconciliation, lines ~228-308 of the skill). Trace the CASE statement logic:
1. First WHEN: `tdp_fp.ID IS NOT NULL` -- catches ALL DyeSub Print items (anything with FP_ProductDescription variable). This runs FIRST, so DyeSub items are never caught by later Description patterns.
2. Second WHEN: `LIKE '%Dyelux%Table Cover%' OR LIKE '%FULL%Table Cover%'` -- catches DyeLux table covers. These items do NOT have FP_ variables (confirmed -- TC_ variables don't persist), so no overlap with DyeSub.
3. Remaining WHEN clauses: Description-based patterns for non-DyeSub, non-DyeLux items.

Verify that the CASE statement order prevents double-counting:
- A DyeSub Feather Flag with Description containing "Flag" will hit WHEN #1 (FP_ variable present) and NOT fall through to the "Flags (accessories/hardware)" group
- A standalone flag hardware sale without FP_ variables WILL fall through to "Flags (accessories/hardware)"
- Document this analysis in the verification report

**Check 2: "Other Products/Services" Bucket**

The $256K "Other" bucket represents 8.4% of revenue. Without MCP, we cannot query its contents directly. Instead:
1. Read `output/phase2-test-results.md` for any notes about the "Other" bucket composition
2. Read `validation/control-erp-validation-results.md` for any product analysis that covers unclassified items
3. Read the reconciliation query output (Test 2.3 in test results) -- does it break down "Other" further?
4. Based on available documentation, assess whether $256K in "Other" is acceptable or whether the skill should flag this as a known limitation

If the "Other" bucket cannot be analyzed without database access:
- Document this as a KNOWN LIMITATION in the skill's Important Caveats section
- Note the recommended follow-up: "When database access is available, sample the top items in the Other bucket (run Template 8, examine 'Other Products/Services' rows sorted by SubTotalPrice DESC)"
- Add this to the verification report

**Check 3: DyeLux and Garment Discrepancy Documentation**

Check if the skill file documents the discrepancy between our query results and Control's "Sales by Product" report:
- DyeLux: our query = $479K, Control report = $537K ($58K gap)
- Garments: our query = $224K, Control report = $261K ($37K gap)
- Grand total: our query = $3,052,953, Control report = $3,053,479 ($526 gap)

The explanation is documented in the test results but should also be in the skill file's Important Caveats section. If missing, add a caveat like:

```
6. **Control Report vs Query Grouping Discrepancy:** Our reconciliation query uses Description pattern matching for non-DyeSub products, while Control's "Sales by Product" report groups by Product entity (GoodsItemID). This causes known differences: DyeLux ($479K query vs $537K report), Garments ($224K vs $261K). DyeSub Print matches precisely ($3 variance) because both methods use the same FP_ variable architecture. Grand total variance is $526 (0.02%).
```

Update the skill file and verification report with any findings.
  </action>
  <verify>
- Read the updated skill file and check for: pattern overlap explanation (or note that CASE order prevents it), "Other" bucket documentation, DyeLux/Garment discrepancy caveat
- Grep for "Control Report" or "Sales by Product" in the skill's Important Caveats section
- Grep for "Other Products" or "$256" in Important Caveats
- Read 04-VERIFICATION.md and confirm it contains pattern overlap analysis section, "Other" bucket analysis, and discrepancy documentation check
  </verify>
  <done>Pattern overlap analysis confirms no double-counting. "Other" bucket ($256K) is documented as a known limitation with follow-up recommendation. DyeLux/Garment discrepancy vs Control report is explained in the skill's Important Caveats. All findings documented in 04-VERIFICATION.md.</done>
</task>

</tasks>

<verification>
Phase-level verification for Plan 1:
1. 04-VERIFICATION.md exists with SALES-01, SALES-02, SALES-03 verification sections
2. Each section has: requirement text, checklist results, gaps found, fixes applied, PASS/FAIL status
3. Pattern overlap analysis shows no double-counting risk
4. "Other" bucket is documented as known limitation
5. DyeLux/Garment discrepancy is explained in skill file
6. If any gaps were found in Task 1, the skill file has been updated
</verification>

<success_criteria>
- SALES-01: All 9 checklist items are PRESENT in the skill (or have been added)
- SALES-02: All 4 checklist items are PRESENT in the skill (or have been added)
- SALES-03: All 4 checklist items are PRESENT in the skill (or have been added)
- Template 8 CASE statement confirmed to prevent double-counting
- "Other Products/Services" bucket documented as known limitation with follow-up guidance
- Control report discrepancy documented in skill's Important Caveats section
- 04-VERIFICATION.md contains formal verification of SALES-01, -02, -03
</success_criteria>

<output>
After completion, create `.planning/phases/04-sales-skill-verification/04-01-SUMMARY.md`
</output>
