---
phase: 08-documentation-milestone-close
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - output/docs/skill-architecture.md
  - output/docs/query-pattern-reference.md
autonomous: true

must_haves:
  truths:
    - "A future Claude session loading the skill architecture doc can identify which skill to load for any given business question"
    - "The dependency graph shows that core is the foundation, sales/financial depend on core, glossary routes to all three"
    - "The order lifecycle table maps each stage (Estimate through Closed) to StatusID, tables involved, GL entries, and skill reference"
    - "The query pattern reference organizes all validated patterns by business question, not by table or domain"
    - "Each query pattern entry includes the NL trigger phrase and references the owning skill + template number without duplicating SQL"
  artifacts:
    - path: "output/docs/skill-architecture.md"
      provides: "DOC-01 + DOC-03 — skill dependency graph, skill summaries, interaction narrative, order lifecycle"
      contains: "mermaid"
    - path: "output/docs/query-pattern-reference.md"
      provides: "DOC-02 — all validated query patterns organized by business question with NL triggers"
      contains: "Revenue & Sales"
  key_links:
    - from: "output/docs/skill-architecture.md"
      to: "skills/control-erp-core/control-erp-core-SKILL.md"
      via: "cross-reference to skill file paths"
    - from: "output/docs/query-pattern-reference.md"
      to: "skills/control-erp-sales/control-erp-sales-SKILL.md"
      via: "template number references (e.g., Template 1, Template 3)"
---

<objective>
Create the skill architecture document (DOC-01 + DOC-03) and query pattern reference (DOC-02) — the two primary onboarding documents for future Claude sessions working with FLS ERP data.

Purpose: These documents answer "what skills exist and how do they work together?" and "where is the query pattern for this business question?" — the two most common needs when a new session starts.

Output: Two markdown files in output/docs/ that synthesize existing skill files, scorecard results, and reference materials into structured, machine-readable onboarding documents.
</objective>

<execution_context>
@/Users/cain/.claude/get-shit-done/workflows/execute-plan.md
@/Users/cain/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-documentation-milestone-close/08-CONTEXT.md
@.planning/phases/08-documentation-milestone-close/08-RESEARCH.md

Source files to synthesize:
@skills/control-erp-core/control-erp-core-SKILL.md
@skills/control-erp-sales/control-erp-sales-SKILL.md
@skills/control-erp-financial/control-erp-financial-SKILL.md
@skills/control-erp-glossary/control-erp-glossary-SKILL.md
@validation/milestone1-scorecard.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create skill architecture document (DOC-01 + DOC-03)</name>
  <files>output/docs/skill-architecture.md</files>
  <action>
Create `output/docs/skill-architecture.md` by synthesizing the four skill files. Structure:

1. **Dependency Graph** — Mermaid diagram showing:
   - control-erp-core as foundation (no dependencies)
   - control-erp-sales depends on core
   - control-erp-financial depends on core
   - control-erp-glossary routes to all three
   - Supporting references: output/skill/references/ (11 files), output/schemas/ (187 files), output/wiki/references/ (3 files)

2. **Skill Summaries** — For each of the 4 skills, include:
   - File path (absolute from project root)
   - Purpose (one sentence)
   - Domains covered (bullet list)
   - Key sections (top 3-5 section names from the skill)
   - Line count
   - Dependencies (what it requires loaded)
   Read each skill's YAML frontmatter and first few sections to extract this info.

3. **How Skills Interact** — Narrative walkthrough (3-5 paragraphs max):
   - A user asks a business question
   - Glossary resolves terminology (e.g., "blanket orders" → DyeSub query)
   - Core provides foundational rules (TransactionType, StatusID, date filtering, pricing)
   - Sales/Financial provide domain-specific templates
   - Reference files provide supporting lookups (ClassTypeID, field values, joins)

4. **Supporting References** — Table listing all 11 reference files in output/skill/references/ plus 3 wiki references:
   - File path, line count, what it provides, which skill(s) use it

5. **Order Lifecycle (DOC-03)** — Table with columns: Stage | StatusID | Key Tables | GL Entries | Skill Reference
   Stages from RESEARCH.md:
   - Estimate (Type 2, StatusID 11) → TransHeader, TransDetail | None | core lines 55-57
   - Estimate Conversion (11→13) → TransHeader (creates Type 1) | None | core lines 55-57
   - New Order (Type 1, StatusID 0) → TransHeader, TransDetail, TransPart | WIP↑, Orders Due↑ | financial lines 276-290
   - WIP (StatusID 1) → TransHeader, TransDetail, ArtworkItem, Station | None | core lines 239-252
   - Built (StatusID 2) → TransHeader | WIP→Built, FGI cost flow | financial lines 291-310
   - Sale (StatusID 3, SaleDate set) → TransHeader | Revenue↑, COGS↑, Inventory↓ | financial lines 311-340
   - Closed (StatusID 4, BalanceDue=0) → TransHeader, Payment | AR cleared | financial lines 341-363
   - Shipping → Shipments, FedExShippingLog/UPSShippingLog | None | schema docs
   - Invoicing/Payment → Payment, Ledger, Journal | AR↓, Cash↑ | financial lines 368-398

Read core skill StatusID table (around lines 239-252) and financial skill GL Transaction Flows (around lines 276-398) to get exact line references.

CRITICAL RULES:
- No SQL blocks — all SQL lives in skills. Reference skill + section name.
- Optimize for machine readability: tables over prose, explicit file paths over vague references.
- Target ~200-300 lines total. If order lifecycle exceeds 150 lines standalone, it stays embedded here (per CONTEXT.md discretion — architecture + lifecycle naturally belong together).
  </action>
  <verify>
Verify the file exists and contains:
- A mermaid code block with the dependency graph
- Four skill summary sections with file paths
- An "Order Lifecycle" section with a table containing at least 8 stages
- File length between 150-350 lines
- No SQL SELECT blocks longer than 3 lines (references only, no duplication)
  </verify>
  <done>
output/docs/skill-architecture.md exists with Mermaid dependency graph, 4 skill summaries, interaction narrative, reference file table, and order lifecycle table. DOC-01 and DOC-03 requirements satisfied.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create query pattern reference (DOC-02)</name>
  <files>output/docs/query-pattern-reference.md</files>
  <action>
Create `output/docs/query-pattern-reference.md` by cross-referencing validated skill templates with scorecard results. Organize by business question (per RESEARCH.md recommendation), NOT by table/domain.

Structure with these sections:

**1. Revenue & Sales** — Patterns answering "what did we sell?"
For each pattern: NL trigger phrase(s) → Skill reference → One-line description → Validated result (from scorecard)
Include:
- "Total sales [year]" → core, Revenue Query Formula → Annual revenue by SaleDate → $3,052,952.52 (Test 1.1)
- "Monthly sales breakdown" → sales, Template 1 → Monthly revenue pivot → Test 5.1
- "Quarterly revenue" → sales, Template 2 → Quarterly with growth % → Test 5.2
- "Compare this year to last year" → sales, Template 7 → YoY comparison → Test 5.3

**2. Product Analysis** — Patterns answering "what products are selling?"
- "Sales by product" / "product breakdown" → sales, Template 8 → Product category revenue → Test 3.1
- "DyeSub Print revenue" → sales, Template 3 → DyeSub category drill-down → Test 3.2
- "Table cover sales" → sales, Template 4 → Table cover identification → Test 3.3
- "Product mix" → sales, Template 8 CASE → Full product categorization

**3. Customer Intelligence** — Patterns answering "who are our customers?"
- "Top customers" / "biggest accounts" → sales, Template 5 → Top N by revenue → Test 4.1
- "Customer [name] history" → sales, Template 6 → Customer detail with product mix → Test 4.2
- "New customers" → core, date filtering + Account.CreatedDate

**4. Estimates & Pipeline** — Patterns answering "what's in the pipeline?"
- "Open estimates" → core, Type 2 + StatusID 11 → Pipeline value
- "Estimate conversion rate" → core, Type 2 StatusID 13 vs 11 → Win rate
- "Estimates this month" → core, EstimateCreatedDate (NOT SaleDate/OrderCreatedDate)

**5. Financial** — Patterns answering "what's our financial position?"
- "AR balance" / "who owes us" → financial, AR Snapshot template
- "AR aging" / "overdue invoices" → financial, AR Aging template
- "AP balance" / "what do we owe" → financial, AP Snapshot template
- "P&L" / "profit and loss" → financial, P&L template
- "GL entries for [account]" → financial, Ledger query pattern
- "Payment history" → financial, Payment query section

**6. Terminology & Routing** — Patterns needing translation
- "[FLS product name]" → glossary, Product Terminology section → Routes to sales skill
- "[Control term]" → glossary, Control Technical Terms → Explains concept + routes to relevant skill

**7. Not Yet Available (Milestone 2)** — Concise list of question types not yet supported:
- Inventory levels, reorder points
- Artwork pipeline status
- Station scheduling, production workload
- Employee/payroll/PTO
- Dashboards and forecasting

For each entry, format as:
```
### "[NL trigger phrase]"
- **Also:** [alternate phrasings]
- **Skill:** [skill-name], [Section/Template #]
- **Returns:** [one-line description of output]
- **Benchmark:** [validated result from scorecard, if applicable]
```

CRITICAL RULES:
- NO SQL in this document. Every pattern references a skill + template/section.
- Use validated skill patterns as authoritative source. Supersedes pre-validation nl_query_patterns.md.
- Include a header note: "This document references validated query patterns from skill files. For actual SQL, load the referenced skill."
- NL trigger phrases come from: core skill NL mapping (lines ~80-95), sales skill NL interpretation (lines ~329-349), financial skill NL interpretation (lines ~760-784).
- Target ~200-350 lines.
  </action>
  <verify>
Verify the file exists and contains:
- At least 6 named sections (Revenue, Product, Customer, Estimates, Financial, Not Yet Available)
- At least 15 distinct NL trigger patterns
- Zero SQL SELECT blocks
- Each pattern references a specific skill and template/section
- File length between 150-400 lines
  </verify>
  <done>
output/docs/query-pattern-reference.md exists with 6+ sections, 15+ NL trigger patterns, zero SQL duplication, and all patterns referencing validated skill templates. DOC-02 requirement satisfied.
  </done>
</task>

</tasks>

<verification>
After both tasks complete:
1. `ls -la output/docs/skill-architecture.md output/docs/query-pattern-reference.md` — both files exist
2. Confirm skill-architecture.md has mermaid block: `grep -c 'mermaid' output/docs/skill-architecture.md` returns >= 1
3. Confirm query-pattern-reference.md has no SQL duplication: `grep -c 'SELECT' output/docs/query-pattern-reference.md` returns 0
4. Confirm order lifecycle table exists: `grep -c 'StatusID' output/docs/skill-architecture.md` returns >= 5
5. Confirm NL triggers present: `grep -c 'Also:' output/docs/query-pattern-reference.md` returns >= 10
</verification>

<success_criteria>
- DOC-01 satisfied: Skill architecture with dependency graph, skill summaries, and interaction narrative exists
- DOC-02 satisfied: Query pattern reference with NL triggers organized by business question exists
- DOC-03 satisfied: Order lifecycle with stages, StatusIDs, tables, GL entries, and skill references exists (embedded in architecture doc)
- No SQL duplication — all patterns reference skills, not raw SQL
- Both documents are machine-readable (tables, structured headings, explicit file paths)
</success_criteria>

<output>
After completion, create `.planning/phases/08-documentation-milestone-close/08-01-SUMMARY.md`
</output>
