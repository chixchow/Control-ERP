---
phase: 01-core-skill-verification
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - skills/control-erp-core/control-erp-core-SKILL.md
  - documentation/control-erp-knowledge-log.md
  - ~/.claude/projects/-Users-cain-projects-control-db-map/memory/MEMORY.md
autonomous: true

must_haves:
  truths:
    - "A user asking 'What StatusIDs exist for Type 2 estimates?' gets 11=Pending, 12=Lost, 13=Converted, 14=Voided from the core skill alone"
    - "A user asking 'What is Type 7 StatusID 28?' gets 'Closed' from every source consistently -- core skill, knowledge log, and MEMORY.md all agree"
    - "Types 3 (Recurring Order), 4 (Credit Memo), and 10 (Vendor Credit Memo) appear in the core skill TransactionType table with their wiki-sourced StatusIDs and a note that they have 0 records at FLS"
    - "The knowledge log Section 7 has no stale TODO markers -- StatusID 2=Built and 4=Closed are filled in, not question marks"
    - "MEMORY.md StatusID listings match the core skill exactly, and outdated claims about the project have been removed"
    - "The knowledge log has a future-entry template showing the required four fields: date, query/method, finding, and source"
    - "The core skill Standard Query Filters section mentions that revenue queries must include SaleDate IS NOT NULL"
  artifacts:
    - path: "skills/control-erp-core/control-erp-core-SKILL.md"
      provides: "Authoritative business rules -- single source of truth for TransactionType, StatusID, pricing, and query filters"
      contains: "Type 10"
    - path: "documentation/control-erp-knowledge-log.md"
      provides: "Chronological record of all validated discoveries with structured entries"
      contains: "Entry Template"
    - path: "~/.claude/projects/-Users-cain-projects-control-db-map/memory/MEMORY.md"
      provides: "Session-persistent quick-reference gotchas consistent with core skill"
  key_links:
    - from: "MEMORY.md StatusID section"
      to: "core skill StatusID Reference"
      via: "values must match exactly"
      pattern: "0=New.*1=WIP.*2=Built.*3=Sale.*4=Closed.*9=Voided"
    - from: "knowledge log Section 2"
      to: "core skill StatusID Reference"
      via: "both authoritative, must agree"
      pattern: "28.*Closed"
    - from: "core skill TransactionType table line for Type 7"
      to: "core skill StatusID Reference Type 7 section"
      via: "internal consistency"
      pattern: "28.*Closed"
---

<objective>
Resolve all contradictions between the four truth sources (core skill, knowledge log, CLAUDE.md, MEMORY.md), fill completeness gaps in the core skill, and structure the knowledge log for future use.

Purpose: Achieve "single source of truth" for Control ERP business rules. After this plan, any document a future session reads will provide consistent, correct information -- no more conflicting StatusID values, stale TODOs, or incomplete type references.

Output: Three updated files -- core skill with all gaps filled, knowledge log with stale markers resolved and entry template added, MEMORY.md with contradictions fixed.
</objective>

<execution_context>
@/Users/cain/.claude/get-shit-done/workflows/execute-plan.md
@/Users/cain/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-core-skill-verification/01-RESEARCH.md
@skills/control-erp-core/control-erp-core-SKILL.md
@documentation/control-erp-knowledge-log.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Resolve core skill contradictions and fill completeness gaps</name>
  <files>skills/control-erp-core/control-erp-core-SKILL.md</files>
  <action>
    Make these specific edits to the core skill file:

    1. **Fix Type 7 description in TransactionType table (line ~45):** Change "StatusID 28=Open" to "StatusID 28=Closed" in the Notes column for Type 7. The StatusID Reference section already correctly says 28=Closed, but the TransactionType table contradicts it.

    2. **Update Types 3, 4, 5 in TransactionType table:** Replace the three "UNUSED" rows with:
       - Type 3: Identity="Recurring Order", Notes="StatusID 21. Zero records at FLS. Documented in wiki."
       - Type 4: Identity="Credit Memo", Notes="StatusID 20=Credit Memo, 9=Voided. Zero records at FLS."
       - Type 5: Leave as "UNUSED" (wiki shows "?" -- genuinely undefined)
       Add Type 10 row: Identity="Vendor Credit Memo", Notes="StatusID 24. Not validated at FLS."

    3. **Fix StatusID 3 naming consistency:** In the TransactionType table row for Type 1, change "3=Sales" to "3=Sale" (singular) to match the StatusID Reference section and the wiki. Check all occurrences in the file and standardize on "Sale" (singular).

    4. **Update FLS Workflow section (around line 52):** Change "Types 3, 4, 5 do NOT exist in FLS data" to "Types 3, 4, 5, 10 have zero or near-zero records at FLS (documented from wiki for completeness)"

    5. **Add revenue filter note to Standard Query Filters section (around line 98-116):** After the existing TransHeader filter block, add a subsection:
       ```
       **Revenue-Specific Filters (in addition to above):**
       ```sql
       AND th.SaleDate IS NOT NULL    -- Exclude orders not yet invoiced
       ```
       Without this filter, WIP and Built orders (no SaleDate) would be included in revenue totals.
       ```

    6. **Verify Types 4 and 10 StatusIDs are already in the StatusID Reference section.** They should be (from my read, they are at lines 274-284). If present, no change needed. If missing, add them.

    Do NOT change any other content. Do NOT rewrite sections that are already correct. Do NOT change the YAML frontmatter. Preserve the exact formatting style of the existing document.
  </action>
  <verify>
    After editing, verify with these specific checks:

    1. TransactionType table Type 7 row no longer says "28=Open":
       `grep -c "28=Open" skills/control-erp-core/control-erp-core-SKILL.md` returns 0

    2. TransactionType table Type 7 row now says "28=Closed" (check specifically in the table row for Type 7, not just anywhere):
       `grep "| \*\*7\*\*" skills/control-erp-core/control-erp-core-SKILL.md` output contains "28=Closed"

    3. Type 10 exists as a row in the TransactionType TABLE (not just in the StatusID Reference section):
       `grep "| \*\*10\*\*" skills/control-erp-core/control-erp-core-SKILL.md` returns a match containing "Vendor Credit Memo"

    4. Only Type 5 remains UNUSED:
       `grep -c "UNUSED" skills/control-erp-core/control-erp-core-SKILL.md` returns exactly 1

    5. "3=Sales" is gone (standardized to "3=Sale"):
       `grep "3=Sales" skills/control-erp-core/control-erp-core-SKILL.md` returns 0 matches

    6. Revenue filter note added:
       `grep "SaleDate IS NOT NULL" skills/control-erp-core/control-erp-core-SKILL.md` returns at least 2 matches
  </verify>
  <done>
    Core skill has zero internal contradictions. Type 7 StatusID 28 says "Closed" everywhere. Types 3, 4, 10 are documented with wiki-sourced StatusIDs. StatusID 3 is consistently named "Sale" (singular). Standard Query Filters section explicitly calls out SaleDate IS NOT NULL for revenue queries.
  </done>
</task>

<task type="auto">
  <name>Task 2: Fix knowledge log stale markers and add entry template</name>
  <files>documentation/control-erp-knowledge-log.md</files>
  <action>
    Make these specific edits to the knowledge log:

    1. **Fix Section 7 stale TODO (line ~367-377):** In the "StatusID for Type 1 Orders" table:
       - Change `| ? | Built |` to `| 2 | Built |`
       - Change `| ? | Closed |` to `| 4 | Closed |`
       - Also add the missing StatusID 0=New row to this table (Section 2 has it, Section 7 does not)
       - Remove the TODO warning block that says "Confirm exact StatusID values for Built and Closed" -- these are now confirmed from the wiki and Section 2 of this very document.

    2. **Fix Section 1 StatusText labels (line ~25):** In the Type 1 row's Notes column, change "StatusIDs: 1=New, 3=Sold, 4=Completed, 9=Voided" to "StatusIDs: 0=New, 1=WIP, 2=Built, 3=Sale, 4=Closed, 9=Voided" to match Section 2's Type 1 StatusID table (which has the authoritative validated values for each StatusID number and label).

    3. **Add entry template after the "How This Document Works" section (after line ~15):** Add a new subsection:
       ```markdown
       ### Entry Template

       Use this format for all new entries:

       | Date | Finding | Method | Source |
       |------|---------|--------|--------|
       | YYYY-MM-DD | What was discovered or confirmed | SQL query, wiki page, user confirmation, or Control report comparison | File or URL where evidence exists |
       ```

    4. **Add a note to Section 10 (Crystal Reports) and Section 11 (CHAPI) stubs** indicating that these will be populated in Phase 3 (Wiki Knowledge Formalization), so future readers know these are intentionally deferred, not forgotten:
       - Section 10: Change "*To be cataloged -- pending user providing report inventory*" to "*Deferred to Phase 3 (Wiki Knowledge Formalization). Crystal Report SQL patterns will be cross-referenced with output/reports/ analysis.*"
       - Section 11: Change "*To be documented -- pending user providing API details*" to "*Deferred to Phase 3 (Wiki Knowledge Formalization). CHAPI architecture documented in output/wiki/extracts/database_integration_knowledge.md.*"

    Do NOT rewrite or restructure existing entries. Do NOT change Section 13 (Corrections Log). Do NOT change any validated findings. Preserve the exact formatting style of surrounding content.
  </action>
  <verify>
    After editing, verify:
    - `grep "? | Built" documentation/control-erp-knowledge-log.md` returns no matches (stale markers gone)
    - `grep "TODO" documentation/control-erp-knowledge-log.md` returns no matches in Section 7 area
    - `grep "Entry Template" documentation/control-erp-knowledge-log.md` returns a match
    - `grep "1=New, 3=Sold" documentation/control-erp-knowledge-log.md` returns no matches (stale labels gone)
    - `grep "Deferred to Phase 3" documentation/control-erp-knowledge-log.md` returns 2 matches (Sections 10 and 11)
  </verify>
  <done>
    Knowledge log Section 7 has resolved StatusIDs (0=New, 1=WIP, 2=Built, 3=Sale, 4=Closed, 9=Voided) with no stale TODO markers. Section 1 StatusText labels match Section 2's Type 1 StatusID table and the core skill. Entry template exists for future use. Stub sections 10 and 11 have explicit deferral notes pointing to Phase 3.
  </done>
</task>

<task type="auto">
  <name>Task 3: Reconcile MEMORY.md with core skill</name>
  <files>~/.claude/projects/-Users-cain-projects-control-db-map/memory/MEMORY.md</files>
  <action>
    Make these specific edits to MEMORY.md (located at /Users/cain/.claude/projects/-Users-cain-projects-control-db-map/memory/MEMORY.md):

    1. **Remove "Project is NOT a git repo" section (lines 52-53):** Delete the entire section header and content. The project IS a git repo (master branch, multiple commits). This is factually wrong.

    2. **Complete Type 1 StatusID listing (line 25):** Change:
       `- Type 1: 1=WIP, 3=Sale, 4=Closed, 9=Voided`
       to:
       `- Type 1: 0=New, 1=WIP, 2=Built, 3=Sale, 4=Closed, 9=Voided`

    3. **Complete Type 7 StatusID listing (line 28):** Change:
       `- Type 7: 25=Requested, 27=Ordered, 31=Received, 28=Closed, 29=Cancelled, 30=Rejected`
       to:
       `- Type 7: 6=Open, 25=Requested, 26=Approved, 27=Ordered, 28=Closed, 29=Cancelled, 30=Rejected, 31=Received`
       (Adding 6=Open and 26=Approved which were missing)

    Do NOT change any other content. The Key Schema Gotchas, TransDetailParam rules, Type 2 date field, Authoritative Business Rules, Wiki Knowledge Base, and Wiki Extract Files sections are all correct and should be preserved exactly as-is.
  </action>
  <verify>
    After editing, verify:
    - `grep "NOT a git repo" /Users/cain/.claude/projects/-Users-cain-projects-control-db-map/memory/MEMORY.md` returns no matches
    - `grep "0=New" /Users/cain/.claude/projects/-Users-cain-projects-control-db-map/memory/MEMORY.md` returns a match (Type 1 now complete)
    - `grep "26=Approved" /Users/cain/.claude/projects/-Users-cain-projects-control-db-map/memory/MEMORY.md` returns a match (Type 7 now complete)
    - `grep "2=Built" /Users/cain/.claude/projects/-Users-cain-projects-control-db-map/memory/MEMORY.md` returns a match (Type 1 now includes Built)
  </verify>
  <done>
    MEMORY.md is consistent with the core skill. Type 1 StatusIDs include all 6 values (0, 1, 2, 3, 4, 9). Type 7 StatusIDs include all 8 values (6, 25, 26, 27, 28, 29, 30, 31). The false "not a git repo" claim is removed. All other content is preserved.
  </done>
</task>

</tasks>

<verification>
After all three tasks complete:

1. **Cross-source consistency check:** Grep for "28=Open" across all four source files -- should return zero matches anywhere.
2. **Type completeness check:** The core skill TransactionType table should have rows for Types 1, 2, 3, 4, 5, 6, 7, 8, 9, 10.
3. **Single source of truth check:** MEMORY.md StatusID listings match core skill StatusID Reference section exactly.
4. **Knowledge log integrity check:** Section 7 StatusID table matches Section 2 StatusID table for Type 1 values.
5. **No regressions:** The core skill's revenue query formula (lines 16-24) is unchanged. The knowledge log's Section 13 (Corrections Log) is unchanged.
</verification>

<success_criteria>
- CORE-01 satisfied: Core skill contains validated TransactionType mappings for all 10 types, StatusID values per type, pricing logic (SubTotalPrice, SaleDate filtering), and standard query filters with revenue-specific note
- CORE-02 satisfied: Knowledge log is structured with date, query/method, finding, and source template; all entries have these elements; stale markers resolved
- Single source of truth: Zero contradictions between core skill, knowledge log, CLAUDE.md, and MEMORY.md for any TransactionType, StatusID, or field name reference
</success_criteria>

<output>
After completion, create `.planning/phases/01-core-skill-verification/01-01-SUMMARY.md`
</output>
