---
phase: 07-test-suite-execution
plan: 02
type: execute
wave: 2
depends_on: ["07-01"]
files_modified:
  - validation/milestone1-scorecard.md
autonomous: true

must_haves:
  truths:
    - "TEST-01: All 21 tests executed with PASS/FAIL results documented in formal scorecard"
    - "TEST-06: Five known gotchas explicitly validated with wrong-value vs correct-value demonstration and impact magnitude"
    - "Scorecard gate evaluated: >=19/21 PASS with zero FAIL on Tier 1"
    - "Estimate lifecycle (conversion rate, pending, pipeline, lost quotes) validated with correct StatusID and date field usage"
    - "Tier 7 behavioral tests validated against skill documentation (not just SQL results)"
  artifacts:
    - path: "validation/milestone1-scorecard.md"
      provides: "Complete 21-test scorecard with all tiers, gotcha section, and final summary"
      contains: "SCORECARD SUMMARY"
    - path: "validation/milestone1-scorecard.md"
      provides: "Gotcha validation section with 5 known traps"
      contains: "Known Gotcha Validation"
  key_links:
    - from: "validation/milestone1-scorecard.md"
      to: "skills/control-erp-core/control-erp-core-SKILL.md"
      via: "Tier 7 behavioral tests reference skill sections that prevent errors"
      pattern: "core.*SKILL"
    - from: "validation/milestone1-scorecard.md"
      to: "phase2-test-suite.md"
      via: "Scorecard gate criteria from test suite definition"
      pattern: "19/21"
---

<objective>
Execute the remaining 10 tests (Tiers 4-7: Estimate/Pipeline, Web Import, Salesperson, Edge Cases), write the explicit gotcha validation section (TEST-06), and compile the final scorecard summary with gate evaluation.

Purpose: This plan completes the formal scorecard, with special emphasis on the gotcha validation section that demonstrates the skills prevent known $1.3M+ errors. The completed scorecard at `validation/milestone1-scorecard.md` is the milestone gate artifact.

Output: Completed `validation/milestone1-scorecard.md` with all 21 tests, gotcha section, and final gate evaluation. This is the deliverable that proves Milestone 1 skills produce accurate results.
</objective>

<execution_context>
@/Users/cain/.claude/get-shit-done/workflows/execute-plan.md
@/Users/cain/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-test-suite-execution/07-RESEARCH.md
@.planning/phases/07-test-suite-execution/07-01-SUMMARY.md
@phase2-test-suite.md
@output/phase2-test-results.md
@skills/control-erp-core/control-erp-core-SKILL.md
@skills/control-erp-sales/control-erp-sales-SKILL.md
@validation/milestone1-scorecard.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Execute Tier 4-6 tests and Tier 7 behavioral assessments</name>
  <files>validation/milestone1-scorecard.md</files>
  <action>
**Use the same MCP/cross-reference method established in Plan 07-01** (read the scorecard header to determine which method was used).

**Tier 4: Estimate and Pipeline Intelligence**

**Test 4.1 -- Estimate Conversion Rate:**
```sql
SELECT StatusID,
    CASE StatusID WHEN 11 THEN 'Pending' WHEN 12 THEN 'Lost' WHEN 13 THEN 'Converted' WHEN 14 THEN 'Voided' END AS StatusLabel,
    COUNT(*) AS EstimateCount,
    CAST(COUNT(*) * 100.0 / SUM(COUNT(*)) OVER() AS DECIMAL(5,1)) AS Percentage
FROM TransHeader
WHERE TransactionType = 2 AND IsActive = 1
GROUP BY StatusID
ORDER BY EstimateCount DESC
```
Expected: ~56.1% converted, ~41.3% lost, ~2.1% voided, ~0.5% pending. Tolerance: +/-3% each.

**Test 4.2 -- Pending Estimates:**
```sql
SELECT COUNT(*) AS PendingCount
FROM TransHeader
WHERE TransactionType = 2 AND IsActive = 1 AND StatusID = 11
```
Expected: 326 (but may have shifted -- any value >0 and <1000 passes). Validates correct StatusID for Pending (11, NOT 1).

**Test 4.3 -- Pipeline Value:**
```sql
SELECT SUM(SubTotalPrice) AS PipelineValue
FROM TransHeader
WHERE TransactionType = 2 AND IsActive = 1 AND StatusID = 11
```
Expected: ~$1,635,895 (but value shifts with new estimates -- any result >$0 passes).

**Test 4.4 -- Lost Quote Analysis:**
```sql
SELECT COUNT(*) AS LostCount, SUM(SubTotalPrice) AS LostValue
FROM TransHeader
WHERE TransactionType = 2 AND IsActive = 1 AND StatusID = 12
    AND EstimateCreatedDate >= '2025-01-01' AND EstimateCreatedDate < '2026-01-01'
```
Expected: 244 lost quotes, $3,268,561. CRITICAL: Must use `EstimateCreatedDate`, NOT `OrderCreatedDate` or `SaleDate` (both are always NULL on Type 2 records).

**Tier 5: Web Import Intelligence**

**Test 5.1 -- Web Order Volume:**
```sql
WITH WebOrders AS (
    SELECT th.ID, th.OrderNumber, th.SubTotalPrice,
        ufd_val.ValueAsStr25 AS ImportOrderNumber,
        ROW_NUMBER() OVER (PARTITION BY ufd_val.ValueAsStr25 ORDER BY th.OrderNumber) AS rn
    FROM TransHeader th
    INNER JOIN TransHeaderUserField ufd_val ON th.ID = ufd_val.TransHeaderID
    INNER JOIN UserFieldDef ufd ON ufd_val.UserFieldDefID = ufd.ID
    WHERE ufd.FieldName = 'Import_Order_Number'
        AND th.TransactionType = 1 AND th.IsActive = 1
        AND th.SaleDate IS NOT NULL AND YEAR(th.SaleDate) = 2025
        AND ufd_val.ValueAsStr25 IS NOT NULL AND ufd_val.ValueAsStr25 != ''
)
SELECT COUNT(*) AS WebOrderCount, SUM(SubTotalPrice) AS WebRevenue
FROM WebOrders WHERE rn = 1
```
Expected: 429 orders, $150,750. Tolerance: +/-5% count, +/-2% revenue.
Red flag: 467/$172K means deduplication was not applied.

**Test 5.2 -- Web vs Total:**
Calculate from Test 5.1 and Test 1.1: Revenue % = 150,750 / 3,052,953 = 4.94%. Count % = 429 / 4,172 = 10.28%.
Expected: ~4.9% revenue, ~10.3% count. Tolerance: +/-1% each.

**Tier 6: Salesperson Performance**

**Test 6.1 -- Revenue by Salesperson:**
```sql
SELECT e.FirstName + ' ' + e.LastName AS Salesperson,
    COUNT(DISTINCT th.ID) AS OrderCount,
    SUM(th.SubTotalPrice) AS Revenue
FROM TransHeader th
LEFT JOIN Employee e ON th.SalesPerson1ID = e.ID
WHERE th.TransactionType = 1 AND th.IsActive = 1 AND th.SaleDate IS NOT NULL AND YEAR(th.SaleDate) = 2025
GROUP BY e.FirstName, e.LastName
ORDER BY Revenue DESC
```
Expected: Sum of all salespeople = $3,052,952.52 (must match Test 1.1 within $1). Josh Gregory #1 at ~$1,547K, Hervy Hodges #2 at ~$1,091K.

**Tier 7: Ambiguity and Edge Cases (Behavioral Assessment)**

These tests evaluate skill documentation quality, NOT SQL query results. For each, reference the specific skill section that provides correct guidance.

**Test 7.1 -- Ambiguous Feather Flags:**
Question: "How are feather flag sales?"
Assessment: Check if `control-erp-sales-SKILL.md` distinguishes DyeSub Feather Flags ($485,666) from Flags hardware/accessories ($4,852). The skill should lead a user to query DyeSub Print with FP_ProductDescription = 'Feather Flags' AND note the separate hardware category.
PASS if: Skill documentation makes the distinction clear. Cite the specific section/line.
FAIL if: Skill only mentions one number without acknowledging both categories.

**Test 7.2 -- Estimate + Revenue Trap:**
Question: "What was our total 2025 revenue including estimates?"
Assessment: Check if `control-erp-core-SKILL.md` explicitly warns against combining Type 1 (revenue) and Type 2 (estimates). The skill should state that converted estimates are already captured in Type 1 sales.
PASS if: Skill explicitly prevents this combination. Cite the specific section/line.
FAIL if: Nothing in the skill prevents adding Type 2 SubTotalPrice to Type 1.

**Test 7.3 -- Wrong Date Field Trap:**
Question: "How many orders were created in December 2025?"
Assessment: Check if skills distinguish SaleDate (when sale was finalized) from OrderCreatedDate (when order was created). For "created" questions, OrderCreatedDate should be used.
PASS if: Skill documents both date fields and their different meanings. Cite the specific section/line.
FAIL if: Skill only mentions SaleDate without explaining when to use OrderCreatedDate.

**Add all Tier 4-7 sections to the scorecard** using the same format as Tiers 1-3 from Plan 07-01. For Tier 7, replace the SQL query field with "Behavioral assessment of skill documentation" and cite the specific skill file and section that provides correct guidance.
  </action>
  <verify>
Read `validation/milestone1-scorecard.md` and confirm:
- Tier 4 section has Tests 4.1-4.4 with PASS/FAIL
- Test 4.4 uses EstimateCreatedDate (not OrderCreatedDate or SaleDate)
- Tier 5 section has Tests 5.1-5.2 with web order deduplication
- Tier 6 section has Test 6.1 with salesperson sum matching Test 1.1
- Tier 7 section has Tests 7.1-7.3 with skill section citations
- All 10 tests in Tiers 4-7 have PASS/FAIL/PARTIAL status
  </verify>
  <done>All 21 tests executed and documented in scorecard. Tiers 4-7 complete with estimate lifecycle, web imports, salesperson, and behavioral assessments. Ready for gotcha section and final compilation.</done>
</task>

<task type="auto">
  <name>Task 2: Write gotcha validation section (TEST-06) and compile final scorecard summary</name>
  <files>validation/milestone1-scorecard.md</files>
  <action>
**Step 1: Add the Known Gotcha Validation section** (satisfies TEST-06). This section explicitly demonstrates that each known trap is correctly handled by the skills. For each gotcha, document the trap, the wrong result, the correct result, and the magnitude of error.

Add this section after Tier 7 and before the final scorecard:

```markdown
## Known Gotcha Validation (TEST-06)

These are documented traps where a naive query produces significantly wrong results. The skills must prevent all of these errors.

### Gotcha 1: TransDetailParam IsActive Filter
**Trap:** Adding `IsActive = 1` filter to TransDetailParam JOIN (natural instinct since most tables need it)
**Wrong result:** DyeSub Print = $464,342 (74% of revenue missing)
**Correct result:** DyeSub Print = $1,793,445
**Impact:** $1,329,103 revenue undercount (286% error)
**Skill prevention:** control-erp-sales-SKILL.md, [cite section] -- explicitly states "NEVER filter IsActive on TransDetailParam"
**Status:** PASS / FAIL

### Gotcha 2: SubTotalPrice vs TotalPrice
**Trap:** Using TotalPrice instead of SubTotalPrice for revenue calculations
**Wrong result:** $3,064,581 (includes tax, not what FLS considers "income")
**Correct result:** $3,052,952.52
**Impact:** $11,629 overcount (0.38% error -- smaller but conceptually wrong)
**Skill prevention:** control-erp-core-SKILL.md, [cite section] -- specifies SubTotalPrice for revenue
**Status:** PASS / FAIL

### Gotcha 3: SaleDate vs OrderCreatedDate
**Trap:** Using OrderCreatedDate for "when did we sell this?" questions
**Wrong result:** Different record sets (253 sold in Dec vs 239 created in Dec)
**Correct result:** SaleDate for revenue/sales queries, OrderCreatedDate for creation date queries
**Impact:** Varies -- wrong date field misattributes revenue to wrong periods
**Skill prevention:** control-erp-core-SKILL.md, [cite section] -- documents both fields with usage guidance
**Status:** PASS / FAIL

### Gotcha 4: EstimateCreatedDate for Type 2
**Trap:** Using SaleDate or OrderCreatedDate for date filtering on Type 2 estimates
**Wrong result:** NULL results (both SaleDate and OrderCreatedDate are always NULL on Type 2)
**Correct result:** Use EstimateCreatedDate -- e.g., 244 lost quotes in 2025 worth $3,268,561
**Impact:** Complete data loss on estimate date queries
**Skill prevention:** control-erp-core-SKILL.md, [cite section] -- documents EstimateCreatedDate requirement
**Status:** PASS / FAIL

### Gotcha 5: SaleDate IS NOT NULL Filter
**Trap:** Omitting `SaleDate IS NOT NULL` when querying Type 1 revenue
**Wrong result:** Includes incomplete/in-progress orders that haven't been finalized
**Correct result:** Only finalized sales (SaleDate IS NOT NULL)
**Impact:** Overstates revenue by including unfinalised records
**Skill prevention:** control-erp-core-SKILL.md, [cite section] -- revenue query formula includes this filter
**Status:** PASS / FAIL
```

For each gotcha, cite the EXACT section in the skill file where the guidance lives. This proves the skills actively prevent these errors.

**Step 2: Compile the final scorecard summary.** Add this after the gotcha section:

```markdown
## Scorecard Summary

| Test | Question Summary | Expected | Actual | Result | Notes |
|------|-----------------|----------|--------|--------|-------|
| 1.1 | Total 2025 sales | ~$3,052,952 | [actual] | [PASS/FAIL] | [brief] |
| 1.2 | Monthly trend | 12 months, sum matches | [actual] | [PASS/FAIL] | |
| ... [all 21 tests] ... |
| 7.3 | Created vs sold date | Use correct field | [actual] | [PASS/FAIL] | |

### Totals
- **PASS:** __/21
- **PARTIAL:** __/21
- **FAIL:** __/21

### Gotcha Validation
- **Gotchas validated:** __/5
- **Total error prevented:** [sum of impact magnitudes, e.g., "$1.3M+ in potential miscounts"]

### Gate Evaluation
**Gate criteria:** PASS if >=19/21 pass with zero FAIL on Tier 1 tests
**Tier 1 status:** [X/4 PASS, 0 FAIL]
**Overall status:** [X/21 PASS]
**Gate result:** **PASS** / **FAIL**

### Requirement Coverage
| Requirement | Tests | Status |
|-------------|-------|--------|
| TEST-01 | All 21 (1.1-7.3) | [PASS: X/21 executed with scorecard] |
| TEST-02 | 1.1 | [PASS/FAIL: $X vs $3,053,541.85 target] |
| TEST-03 | 2.1, 2.2, 2.3, 2.4 | [PASS/FAIL: DyeSub match] |
| TEST-04 | 3.1, 3.2, 3.3 | [PASS/FAIL: customer match] |
| TEST-05 | 1.2, 1.3, 1.4 | [PASS/FAIL: trend consistency] |
| TEST-06 | Gotcha validation | [PASS/FAIL: X/5 gotchas validated] |
```

**Step 3: Add closing section:**
```markdown
## Validation Complete

**Date:** [execution date]
**Validated by:** Claude (automated execution against StoreData / cross-reference validation)
**Skills version:** Milestone 1 final (core rev 2, sales rev 2, financial v1, glossary v1)

The Milestone 1 skill package produces revenue figures within 0.02% of FLS's known income, product breakdowns within $3 of Control's official reports, and prevents $1.3M+ in known query traps through documented gotcha avoidance. The skills are ready for production use by FLS team members.
```
  </action>
  <verify>
Read `validation/milestone1-scorecard.md` and confirm:
- Known Gotcha Validation section exists with 5 gotchas
- Each gotcha has trap, wrong result, correct result, impact, skill citation, and status
- Gotcha 1 (TransDetailParam) shows $464K vs $1,793K with 286% error
- Scorecard Summary table has all 21 tests
- Totals section shows PASS/PARTIAL/FAIL counts summing to 21
- Gate evaluation section with criteria, tier 1 status, overall, and gate result
- Requirement coverage table maps all 6 TEST requirements to results
- Closing section with date and summary statement
- File is self-contained and readable as a standalone milestone artifact
  </verify>
  <done>Complete milestone scorecard at `validation/milestone1-scorecard.md` with all 21 tests, 5 gotcha validations, scorecard summary, gate evaluation, requirement coverage, and closing statement. All 6 TEST requirements addressed. Milestone 1 validation artifact is complete.</done>
</task>

</tasks>

<verification>
Plan-level verification for 07-02:
1. Tier 4 (Tests 4.1-4.4): Conversion rate ~56%, pending estimates >0, pipeline >$0, lost quotes use EstimateCreatedDate
2. Tier 5 (Tests 5.1-5.2): Deduplicated web orders = ~429/$150K, web % = ~4.9%/~10.3%
3. Tier 6 (Test 6.1): Salesperson sum = Test 1.1 revenue (within $1)
4. Tier 7 (Tests 7.1-7.3): Behavioral assessments with skill section citations
5. Gotcha section: All 5 gotchas documented with wrong/correct/impact/citation
6. Scorecard summary: 21 rows, totals, gate evaluation, requirement coverage
7. Gate result documented (PASS if >=19/21 and 0 Tier 1 failures)
8. All 6 TEST requirements mapped to specific test results
</verification>

<success_criteria>
- TEST-01 satisfied: All 21 tests executed with formal scorecard at `validation/milestone1-scorecard.md`
- TEST-06 satisfied: 5 gotchas explicitly validated with wrong-vs-correct values and skill citations
- Scorecard has gate evaluation (>=19/21 PASS, 0 Tier 1 FAIL)
- Requirement coverage table maps all 6 TEST requirements to results
- File is a standalone artifact that proves Milestone 1 accuracy to any reviewer
- No test shows FAIL without documented root cause and remediation path
</success_criteria>

<output>
After completion, create `.planning/phases/07-test-suite-execution/07-02-SUMMARY.md`
</output>
