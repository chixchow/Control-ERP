---
phase: 07-test-suite-execution
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - validation/milestone1-scorecard.md
autonomous: true

must_haves:
  truths:
    - "TEST-02: Revenue baseline test produces $3,052,952.52 (within 1% of $3,053,541.85 known income)"
    - "TEST-03: DyeSub Print category breakdown shows 21 categories totaling $1,793,445 (within $100 of Control report $1,793,442)"
    - "TEST-04: Top 10 customers list has FLASH Visual Media at #1 ($430,578), top 10 combined = ~$1.5M (49.3%)"
    - "TEST-05: Monthly trend produces 12 rows summing within $5 of annual total; Q4 = $592,789; YoY shows both 2024 and 2025"
    - "All 11 tests (Tiers 1-3) have PASS/FAIL status with actual values and variance documented"
  artifacts:
    - path: "validation/milestone1-scorecard.md"
      provides: "First 11 rows of scorecard table with Tier 1-3 results"
      contains: "Tier 1.*Revenue Fundamentals"
  key_links:
    - from: "validation/milestone1-scorecard.md"
      to: "output/phase2-test-results.md"
      via: "Cross-references or live-executes the same queries from prior Rev 2 run"
      pattern: "phase2-test-results"
    - from: "validation/milestone1-scorecard.md"
      to: "skills/control-erp-sales/control-erp-sales-SKILL.md"
      via: "Query templates used to produce test results"
      pattern: "Template"
---

<objective>
Execute the first 11 tests from the Phase 2 test suite (Tiers 1-3: Revenue Fundamentals, Product Intelligence, Customer Intelligence) and write the initial scorecard document with results.

Purpose: These 11 tests cover the critical quantitative requirements TEST-02 (revenue baseline), TEST-03 (product breakdown), TEST-04 (customer revenue), and TEST-05 (date range/trend consistency). They are the highest-value tests because they validate the core revenue and product queries that FLS will use daily.

Output: `validation/milestone1-scorecard.md` with header, methodology section, and Tier 1-3 results (11 of 21 tests documented). Plan 07-02 will add Tiers 4-7, gotcha section, and final scorecard summary.
</objective>

<execution_context>
@/Users/cain/.claude/get-shit-done/workflows/execute-plan.md
@/Users/cain/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-test-suite-execution/07-RESEARCH.md
@phase2-test-suite.md
@output/phase2-test-results.md
@skills/control-erp-core/control-erp-core-SKILL.md
@skills/control-erp-sales/control-erp-sales-SKILL.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Execute Tier 1 (Revenue Fundamentals) and Tier 2 (Product Intelligence) tests</name>
  <files>validation/milestone1-scorecard.md</files>
  <action>
**Step 1: Attempt MCP connection.** Try to run a simple test query via the MSSQL MCP tools:
```sql
SELECT COUNT(*) AS TestCount FROM TransHeader WHERE TransactionType = 1 AND YEAR(SaleDate) = 2025
```
If MCP responds with ~4,172, proceed with live execution. If MCP is unavailable (error/timeout), use the cross-reference fallback path. Document which method is used at the top of the scorecard.

**Step 2: Create the scorecard file** at `validation/milestone1-scorecard.md` with this structure:

```markdown
# Milestone 1: Formal Validation Scorecard

**Project:** Project Cornerstone -- Control ERP Natural Language Interface
**Date:** [execution date]
**Skills Tested:** control-erp-core (rev 2), control-erp-sales (rev 2), control-erp-financial, control-erp-glossary
**Test Suite:** phase2-test-suite.md (21 tests, 7 tiers)
**Method:** [MCP live execution against StoreData / Cross-reference against validated results from 2026-02-07]
**Gate Criteria:** PASS if >=19/21 pass with zero FAIL on Tier 1 tests

## Revenue Target Note
The success criteria specify "$3,053,541.85 (within 1%)" -- this is the known FLS income figure. The validated SubTotalPrice query returns $3,052,952.52, a $589 variance (0.02%). Both numbers are documented; the test passes because the query result is within the 1% tolerance of the known income figure.

## Tier 1: Revenue Fundamentals
[results here]

## Tier 2: Product Intelligence
[results here]
```

**Step 3: Execute (or cross-reference) Tier 1 tests:**

**Test 1.1 -- Total Annual Revenue (TEST-02):**
```sql
SELECT SUM(SubTotalPrice) AS Revenue, COUNT(*) AS OrderCount
FROM TransHeader
WHERE TransactionType = 1 AND IsActive = 1 AND SaleDate IS NOT NULL AND YEAR(SaleDate) = 2025
```
Expected: $3,052,952.52 (4,172 orders). Tolerance: within 1% of $3,053,541.85.
Red flag: ~$3,064,581 means TotalPrice was used. ~$936K means Type 2 was included.

**Test 1.2 -- Monthly Revenue Trend (TEST-05):**
```sql
SELECT MONTH(SaleDate) AS SaleMonth, SUM(SubTotalPrice) AS Revenue, COUNT(*) AS OrderCount
FROM TransHeader
WHERE TransactionType = 1 AND IsActive = 1 AND SaleDate IS NOT NULL AND YEAR(SaleDate) = 2025
GROUP BY MONTH(SaleDate) ORDER BY SaleMonth
```
Expected: 12 rows. Sum = ~$3,052,949. Check: sum matches Test 1.1 within $5.

**Test 1.3 -- Q4 Revenue (TEST-05):**
Calculate from Test 1.2 results: Oct + Nov + Dec. Expected: $592,789.

**Test 1.4 -- Year-over-Year (TEST-05):**
```sql
SELECT YEAR(SaleDate) AS SaleYear, SUM(SubTotalPrice) AS Revenue, COUNT(*) AS OrderCount
FROM TransHeader
WHERE TransactionType = 1 AND IsActive = 1 AND SaleDate IS NOT NULL
GROUP BY YEAR(SaleDate) ORDER BY SaleYear DESC
```
Expected: 2025 = ~$3,052,953 (4,172), 2024 = ~$3,060,289 (4,302). Both plausible.

**Step 4: Execute (or cross-reference) Tier 2 tests:**

**Test 2.1 -- DyeSub Print Category Breakdown (TEST-03):**
```sql
SELECT tdp.ValueAsStr25 AS ProductCategory,
    COUNT(DISTINCT th.ID) AS OrderCount,
    SUM(td.SubTotalPrice) AS Revenue
FROM TransHeader th
INNER JOIN TransDetail td ON th.ID = td.TransHeaderID AND td.IsActive = 1
INNER JOIN TransDetailParam tdp ON tdp.ParentID = td.ID AND tdp.VariableID = 11053
WHERE th.TransactionType = 1 AND th.IsActive = 1 AND th.SaleDate IS NOT NULL AND YEAR(th.SaleDate) = 2025
GROUP BY tdp.ValueAsStr25
ORDER BY Revenue DESC
```
Expected: 21 categories. Total = $1,793,445 (Control report says $1,793,442, $3 variance).
CRITICAL: Verify NO IsActive or ParentClassTypeID filter on TransDetailParam. If DyeSub total is ~$464K, the WRONG filter was applied.

**Test 2.2 -- Table Cover Revenue (TEST-03):**
Use Description-based LIKE patterns for DyeLux and Other table covers.
Expected: DyeLux = $479,184 (852 items), Other = $68,997, Combined = $548,181.

**Test 2.3 -- Full Product Revenue Reconciliation (TEST-03):**
Run the full CASE statement reconciliation query from the sales skill (Template 8).
Expected: 11 product groups. Detail-level total = ~$3,047,058. Header-detail gap = ~$5,895.
All groups should be present: DyeSub Print, DyeLux, Garments, Other, Design/Artwork, Other TC, Shipping, Tents, Banners HW, SEG HW, Flags HW.

**Test 2.4 -- Swing Flag Monthly Trend (TEST-03):**
```sql
SELECT MONTH(th.SaleDate) AS SaleMonth,
    COUNT(DISTINCT th.ID) AS OrderCount,
    SUM(td.SubTotalPrice) AS Revenue
FROM TransHeader th
INNER JOIN TransDetail td ON th.ID = td.TransHeaderID AND td.IsActive = 1
INNER JOIN TransDetailParam tdp ON tdp.ParentID = td.ID AND tdp.VariableID = 11053
WHERE th.TransactionType = 1 AND th.IsActive = 1 AND th.SaleDate IS NOT NULL
    AND YEAR(th.SaleDate) = 2025 AND tdp.ValueAsStr25 = 'Swing Flags'
GROUP BY MONTH(th.SaleDate) ORDER BY SaleMonth
```
Expected: Annual total = $615,203. Seasonal: Jul-Sep = ~78% of annual.

**Step 5: Document each test result** in the scorecard with this format per test:
```
### Test X.Y -- [Name]
**Question:** "[natural language question]"
**Query:** [SQL used or "cross-referenced from Rev 2 results"]
**Expected:** [value]
**Actual:** [value]
**Variance:** [amount and percentage]
**Result:** PASS / FAIL / PARTIAL
**Notes:** [any relevant observations]
```

**Internal consistency checks to document:**
- Sum of 12 monthly revenues = annual total (within $5)
- Sum of DyeSub categories = DyeSub total ($1,793,445)
- Sum of all product groups = detail total (~$3,047,058)
- Q4 = Oct + Nov + Dec (exact)
  </action>
  <verify>
Read `validation/milestone1-scorecard.md` and confirm:
- Header section with date, method, skills tested, gate criteria
- Revenue Target Note section explaining $3,053,541.85 vs $3,052,952.52
- Tier 1 section with Tests 1.1-1.4, each having Expected/Actual/Variance/Result
- Tier 2 section with Tests 2.1-2.4, each having Expected/Actual/Variance/Result
- Test 1.1 actual = $3,052,952.52 (within 1% tolerance)
- Test 2.1 DyeSub total = $1,793,445 (within $100 of $1,793,442)
- Internal consistency checks documented
  </verify>
  <done>Tier 1 and Tier 2 tests (8 of 21) documented in scorecard with PASS/FAIL status, actual values, variances, and internal consistency verification. Revenue baseline and product breakdown requirements satisfied.</done>
</task>

<task type="auto">
  <name>Task 2: Execute Tier 3 (Customer Intelligence) tests</name>
  <files>validation/milestone1-scorecard.md</files>
  <action>
**Step 1: Execute (or cross-reference) Tier 3 tests:**

**Test 3.1 -- Top 10 Customers (TEST-04):**
```sql
SELECT TOP 10 a.CompanyName,
    COUNT(DISTINCT th.ID) AS OrderCount,
    SUM(th.SubTotalPrice) AS Revenue
FROM TransHeader th
INNER JOIN Account a ON th.AccountID = a.ID
WHERE th.TransactionType = 1 AND th.IsActive = 1 AND th.SaleDate IS NOT NULL AND YEAR(th.SaleDate) = 2025
GROUP BY a.CompanyName
ORDER BY Revenue DESC
```
Expected: #1 = FLASH Visual Media ($430,578), #2 = Propvinyls ($319,959), #3 = PAC BannerWorks ($218,354). Top 10 combined = $1,506,214 (49.3% of total).
Document the full top-10 table in the scorecard.

**Test 3.2 -- Specific Customer Lookup (TEST-04):**
```sql
SELECT a.CompanyName, td.Description,
    COUNT(DISTINCT th.ID) AS OrderCount,
    SUM(td.SubTotalPrice) AS Revenue
FROM TransHeader th
INNER JOIN Account a ON th.AccountID = a.ID
INNER JOIN TransDetail td ON th.ID = td.TransHeaderID AND td.IsActive = 1
WHERE th.TransactionType = 1 AND th.IsActive = 1 AND th.SaleDate IS NOT NULL
    AND YEAR(th.SaleDate) = 2025 AND a.CompanyName LIKE '%PAC%Banner%'
GROUP BY a.CompanyName, td.Description
ORDER BY Revenue DESC
```
Expected: Multiple product lines returned. Top item = Double Sided Medium Feather Flag (~$112,734). Revenue > $0.

**Test 3.3 -- Total Order Count (TEST-04):**
```sql
SELECT COUNT(DISTINCT ID) AS OrderCount
FROM TransHeader
WHERE TransactionType = 1 AND IsActive = 1 AND SaleDate IS NOT NULL AND YEAR(SaleDate) = 2025
```
Expected: 4,172 orders. Tolerance: +/-5% (3,963 - 4,381).

**Step 2: Add Tier 3 section to scorecard** using the same format as Tiers 1-2.

**Step 3: Add a running tally** at the bottom of what's been completed so far:
```markdown
## Progress (Tiers 1-3 Complete)
| Tier | Tests | Passed | Failed | Partial |
|------|-------|--------|--------|---------|
| 1. Revenue Fundamentals | 4 | ?/4 | ?/4 | ?/4 |
| 2. Product Intelligence | 4 | ?/4 | ?/4 | ?/4 |
| 3. Customer Intelligence | 3 | ?/3 | ?/3 | ?/3 |
| **Subtotal** | **11** | **?/11** | **?/11** | **?/11** |

*Tiers 4-7 and formal scorecard summary in Plan 07-02.*
```
  </action>
  <verify>
Read `validation/milestone1-scorecard.md` and confirm:
- Tier 3 section exists with Tests 3.1, 3.2, 3.3
- Test 3.1 shows full top-10 table with FLASH Visual Media at #1
- Test 3.2 shows PAC BannerWorks detail with multiple product lines
- Test 3.3 shows order count = 4,172 (within 5% tolerance)
- Progress tally at bottom shows 11 tests with pass/fail counts
- All 11 tests have a PASS/FAIL/PARTIAL status assigned
  </verify>
  <done>All 11 Tier 1-3 tests documented in scorecard with results. Customer intelligence (TEST-04) validated. Running tally shows progress toward 21-test completion. Scorecard ready for Plan 07-02 to add Tiers 4-7 and compile final summary.</done>
</task>

</tasks>

<verification>
Plan-level verification for 07-01:
1. `validation/milestone1-scorecard.md` exists with header, methodology, and revenue target note
2. Tier 1 (Tests 1.1-1.4): All PASS with revenue = $3,052,952.52, monthly sum within $5, Q4 = $592,789, YoY shows both years
3. Tier 2 (Tests 2.1-2.4): All PASS with DyeSub = $1,793,445, table covers = $548,181, reconciliation = ~$3,047K, Swing Flags = $615,203
4. Tier 3 (Tests 3.1-3.3): All PASS with FLASH #1 at $430K, PAC BannerWorks has detail, order count = 4,172
5. Internal consistency checks pass: monthly = annual, DyeSub categories = total, groups = detail total
6. Running tally at bottom shows 11/11 tests with status
</verification>

<success_criteria>
- TEST-02 satisfied: Revenue baseline documented as $3,052,952.52, within 1% of $3,053,541.85
- TEST-03 satisfied: DyeSub breakdown (21 categories, $1,793,445), table covers ($548,181), reconciliation, Swing Flag trend all documented
- TEST-04 satisfied: Top 10 customers documented, PAC BannerWorks detail shown, order count = 4,172
- TEST-05 satisfied: Monthly trend (12 rows), Q4 revenue, YoY comparison all documented with consistency checks
- 11/11 tests in Tiers 1-3 have PASS/FAIL status with actual values and variance
- Scorecard file structured for Plan 07-02 to append Tiers 4-7 and final summary
</success_criteria>

<output>
After completion, create `.planning/phases/07-test-suite-execution/07-01-SUMMARY.md`
</output>
